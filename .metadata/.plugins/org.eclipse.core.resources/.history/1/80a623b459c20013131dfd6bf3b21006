<!-- wardexample BPEL Process [Generated by the Eclipse BPEL Designer] -->
<!-- Date: Fri Apr 11 11:45:41 CEST 2014 -->
<bpel:process name="wardexample"
         targetNamespace="http://www.PAHospital.org/WardService/"
         suppressJoinFailure="yes"
         xmlns:tns="http://www.PAHospital.org/WardService/"
         xmlns:bpel="http://docs.oasis-open.org/wsbpel/2.0/process/executable"
         xmlns:pat="http://www.PAHospital.org/PatService/"
         xmlns:tra="http://www.PAHospital.org/TransportationService/"
         xmlns:lab="http://www.PAHospital.org/LabService/"
         xmlns:lcb="http://www.PAHospital.org/LabCallbackService/"
         xmlns:rad="http://www.PAHospital.org/RadiologyService/"
         xmlns:rcb="http://www.PAHospital.org/RadiologyCallbackService/"
         >
         
    <!-- Import the client WSDLs -->
	<bpel:import location="WardService.wsdl" namespace="http://www.PAHospital.org/WardService/" 
	        importType="http://schemas.xmlsoap.org/wsdl/" />
	<bpel:import location="RadService-callback.wsdl" namespace="http://www.PAHospital.org/RadiologyCallbackService/"
			importType="http://schemas.xmlsoap.org/wsdl/" />
	<bpel:import location="LabService-callback.wsdl" namespace="http://www.PAHospital.org/LabCallbackService/"
			importType="http://schemas.xmlsoap.org/wsdl/" />

	<!-- Import the server WSDLs -->
	<bpel:import location="PatService.wsdl" namespace="http://www.PAHospital.org/PatService/"
			importType="http://schemas.xmlsoap.org/wsdl/" />
	<bpel:import location="RadService.wsdl" namespace="http://www.PAHospital.org/RadiologyService/"
			importType="http://schemas.xmlsoap.org/wsdl/" />
	<bpel:import location="LabService.wsdl" namespace="http://www.PAHospital.org/LabService/"
			importType="http://schemas.xmlsoap.org/wsdl/" />
	<bpel:import location="TranspService.wsdl" namespace="http://www.PAHospital.org/TransportationService/"
			importType="http://schemas.xmlsoap.org/wsdl/" />
	
	<!-- <bpel:correlationSets>
		<bpel:correlationSet name="PatientID" properties="tns:PatientID" />
	</bpel:correlationSets>  -->
	
    <!-- ================================================================= -->         
    <!-- ORCHESTRATION LOGIC                                               -->
    <!-- Set of activities coordinating the flow of messages across the    -->
    <!-- services integrated within this business process                  -->
    <!-- ================================================================= -->         
    
    <bpel:partnerLinks>
    	<bpel:partnerLink name="ward" partnerLinkType="tns:WardServiceLinkType"
    		myRole="ward" />
    	<bpel:partnerLink name="patientService" partnerLinkType="tns:PatServiceLinkType"
    		partnerRole="patientRecord" />
    	<bpel:partnerLink name="TransportService" partnerLinkType="tns:TranspServiceLinkType"
    		partnerRole="transportService" />	
    	<bpel:partnerLink name="laboratoryService" partnerLinkType="tns:LabServiceLinkType"
    		partnerRole="laboratoryDept" myRole="laboratoryCallback" />
    	<bpel:partnerLink name="radiologyService" partnerLinkType="tns:RadServiceLinkType"
    		partnerRole="radiologyDept" myRole="radiologyCallback"  />
    </bpel:partnerLinks>
    
    <bpel:variables>
    	<bpel:variable name="AdmissionForm" messageType="tns:AdmissionOrderMessage" />
    	<bpel:variable name="Response" messageType="tns:TestResponseMessage" />
    	
    	<bpel:variable name="CreatePatientRequest" messageType="pat:CreatePatientRecordRequest" />
    	
    	<bpel:variable name="GetPatientIDsRequest" messageType="pat:GetPatientIDsRequest" />
    	<bpel:variable name="GetPatientIDsResponse" messageType="pat:GetPatientIDsResponse" />
    	
    	<!-- 
    	<bpel:variable name="patient" messageType="pat:CreatePatientRecordRequest" />
    	<bpel:variable name="createPatientResponse" messageType="pat:CreatePatientRecordResponse" />
    	<bpel:variable name="radiologyOrder" messageType="rad:RadiologyOrderRadExaminationRequest" />
    	<bpel:variable name="appointment" messageType="rad:RadiologyRequestAppointmentRequest" />
    	<bpel:variable name="radiologyOrderResponse" messageType="rad:RadiologyOrderRadExaminationResponse" />
    	<bpel:variable name="appointmentResponse" messageType="rad:RadiologyRequestAppointmentResponse" />
    	<bpel:variable name="callBackReq" messageType="rcb:RadiologyReportRequest" />
    	-->
    </bpel:variables>

	<bpel:sequence name="main">
		<bpel:receive name="Recieve-admissionForm" partnerLink="ward"
			portType="tns:WardServicePT" operation="AdmissionOrder" variable="AdmissionForm"
			createInstance="yes">
		</bpel:receive> 
		
		<bpel:assign validate="no" name="InitialPatientVariable">
			<bpel:copy>
				<bpel:from>
					<bpel:literal>
						<pat:Patient>
							<PatientID>PatientID</PatientID>
							<PatientName>PatientName</PatientName>
							<PatientStreet>PatientStreet</PatientStreet>
							<PatientZipCode>0000</PatientZipCode>
							<PatientCity>PatientCity</PatientCity>
							<PatientBirthday>2014-01-01</PatientBirthday>
						</pat:Patient>
					</bpel:literal>
				</bpel:from>
				<bpel:to>$CreatePatientRequest.Patient</bpel:to>
			</bpel:copy>
		</bpel:assign>
		
		<bpel:assign validate="no" name="AdmissionForm-to-CreatPatientRequest">
			<bpel:copy>
				<bpel:from>$AdmissionForm.AdmissionOrder/PatientID</bpel:from>
				<bpel:to>$CreatePatientRequest.Patient/PatientID</bpel:to>
			</bpel:copy>
			<bpel:copy>
				<bpel:from>$AdmissionForm.AdmissionOrder/PatientName</bpel:from>
				<bpel:to>$CreatePatientRequest.Patient/PatientName</bpel:to>
			</bpel:copy>
		</bpel:assign>
		
		<bpel:assign validate="no" name="AdmissionForm-to-GetPatientIDsRequest">
			<bpel:copy>
				<bpel:from>$AdmissionForm.AdmissionOrder/PatientName</bpel:from>
				<bpel:to>$GetPatientIDsRequest.PatientName</bpel:to>
			</bpel:copy>
		</bpel:assign>
		
		<bpel:invoke name="Invoke-PatientService-GetPatientIDsByName" partnerLink="patientService"
			operation="GetPatientIDsByName" portType="pat:ElectronicPatientRecord" inputVariable="GetPatientIDsRequest"
			outputVariable="GetPatientIDsResponse"></bpel:invoke>
		
		<!-- Dit is zodat we een response krijgen voor de Ward Operation -->
		<bpel:assign validate="no" name="ResponseTEST">
			<bpel:copy>
				<bpel:from><bpel:literal><tns:TesterElem>Condition is false</tns:TesterElem></bpel:literal></bpel:from>
				<bpel:to>$Response.TestResponse</bpel:to>
			</bpel:copy>
		</bpel:assign>
		
		<!-- Hier is een IF-Condition in het geval dat de patient nog niet bestaat in de database wordt die aangemaakt -->
		<bpel:if name="new-patient">
			<bpel:condition>not(contains($GetPatientIDsResponse.PatientIDsList,$AdmissionForm.AdmissionOrder/PatientID))</bpel:condition>
			<bpel:assign validate="no" name="ResponseTEST">
				<bpel:copy>
					<bpel:from><bpel:literal><tns:TesterElem>Condition is true</tns:TesterElem></bpel:literal></bpel:from>
					<bpel:to>$Response.TestResponse</bpel:to>
				</bpel:copy>
			</bpel:assign>
		</bpel:if>
		

				 
		<bpel:reply name="Reply-Response" partnerLink="ward"
			portType="tns:WardServicePT" operation="AdmissionOrder" variable="Response"></bpel:reply>
		<!-- Dit is het eind van de test response voor de Ward Operation --> 
		
	</bpel:sequence>
</bpel:process>

