<!-- wardexample BPEL Process [Generated by the Eclipse BPEL Designer] -->
<!-- Date: Fri Apr 11 11:45:41 CEST 2014 -->
<bpel:process name="wardexample"
         targetNamespace="http://www.PAHospital.org/WardService/"
         suppressJoinFailure="yes"
         xmlns:tns="http://www.PAHospital.org/WardService/"
         xmlns:bpel="http://docs.oasis-open.org/wsbpel/2.0/process/executable"
         xmlns:pat="http://www.PAHospital.org/PatService/"
         xmlns:rad="http://www.PAHospital.org/RadiologyService/"
         xmlns:rcb="http://www.PAHospital.org/RadiologyCallbackService/"
         >
         
    <!-- Import the client WSDLs -->
	<bpel:import location="WardService.wsdl" namespace="http://www.PAHospital.org/WardService/" 
	        importType="http://schemas.xmlsoap.org/wsdl/" />
	<bpel:import location="RadService-callback.wsdl" namespace="http://www.PAHospital.org/RadiologyCallbackService/"
			importType="http://schemas.xmlsoap.org/wsdl/" />

	<!-- Import the server WSDLs -->
	<bpel:import location="PatService.wsdl" namespace="http://www.PAHospital.org/PatService/"
			importType="http://schemas.xmlsoap.org/wsdl/" />
	<bpel:import location="RadService.wsdl" namespace="http://www.PAHospital.org/RadiologyService/"
			importType="http://schemas.xmlsoap.org/wsdl/" />
	<bpel:import location="RadService-callback.wsdl" namespace="http://www.PAHospital.org/RadiologyCallbackService/"
			importType="http://schemas.xmlsoap.org/wsdl/" />
	
	<!-- <bpel:correlationSets>
		<bpel:correlationSet name="PatientID" properties="tns:PatientID" />
	</bpel:correlationSets>  -->
	
    <!-- ================================================================= -->         
    <!-- ORCHESTRATION LOGIC                                               -->
    <!-- Set of activities coordinating the flow of messages across the    -->
    <!-- services integrated within this business process                  -->
    <!-- ================================================================= -->         
    
    <bpel:partnerLinks>
    	<bpel:partnerLink name="ward" partnerLinkType="tns:WardServiceLinkType"
    		myRole="ward" />
    	<bpel:partnerLink name="patientRecord" partnerLinkType="tns:PatServiceLinkType"
    		partnerRole="patientRecord" />
    	<bpel:partnerLink name="radiologyDept" partnerLinkType="tns:RadServiceLinkType"
    		partnerRole="radiologyDept" myRole="radiologyCallBack"  />
    </bpel:partnerLinks>
    
    <bpel:variables>
    	<bpel:variable name="admissionForm" messageType="tns:AdmissionOrderMessage" />
    	<bpel:variable name="response" messageType="tns:TestResponseMessage" />
    	<bpel:variable name="patient" messageType="pat:CreatePatientRecordRequest" />
    	<bpel:variable name="createPatientResponse" messageType="pat:CreatePatientRecordResponse" />
    	<bpel:variable name="radiologyOrder" messageType="rad:RadiologyOrderRadExaminationRequest" />
    	<bpel:variable name="appointment" messageType="rad:RadiologyRequestAppointmentRequest" />
    	<bpel:variable name="radiologyOrderResponse" messageType="rad:RadiologyOrderRadExaminationResponse" />
    	<bpel:variable name="appointmentResponse" messageType="rad:RadiologyRequestAppointmentResponse" />
    </bpel:variables>

	<bpel:sequence name="main">
		<bpel:receive name="Recieve-admissionForm" partnerLink="ward"
			portType="tns:WardServicePT" operation="AdmissionOrder" variable="admissionForm"
			createInstance="yes">
			<!-- <bpel:correlations>
				<bpel:correlation set="PatientID" initiate="yes" />
			</bpel:correlations>  -->
		</bpel:receive>
		
		<bpel:assign validate="no" name="Assign-PatientRecord">
			<bpel:copy>
				<bpel:from>$admissionForm.AdmissionOrder</bpel:from>
				<bpel:to>$patient.Patient</bpel:to>
			</bpel:copy>
		</bpel:assign>
		
		<bpel:invoke name="Invoke-PatService-CreatePatientRecord" partnerLink="patientRecord"
			portType="pat:ElectronicPatientRecord" operation="CreatePatientRecord" inputVariable="patient"
			outputVariable="createPatientResponse"></bpel:invoke>
			
		<bpel:assign validate="no" name="Assign-RadiologyOrder">
			<bpel:copy>
				<bpel:from>
					<bpel:literal>
						<rad:RadiologyOrder>
							<PatientID>12345</PatientID>
							<CaseID>101</CaseID>
							<ExaminationType>CT</ExaminationType>
						</rad:RadiologyOrder>
					</bpel:literal>
				</bpel:from>
				<bpel:to>$radiologyOrder.Order</bpel:to>
			</bpel:copy>
		</bpel:assign>	
		
		<bpel:invoke name="Invoke-RadService-RadiologyOrder" partnerLink="radiologyDept"
			portType="rad:Radiology" operation="OrderRadiologyExamination" inputVariable="radiologyOrder"
			outputVariable="radiologyOrderResponse"></bpel:invoke>
		
		<bpel:assign validate="no" name="RadAppointment">
			<bpel:copy>
				<bpel:from>
					<bpel:literal>
						<rad:Appointment>
							<OrderID>101</OrderID>
							<Date>2011-11-11</Date>
						</rad:RadiologyOrder>
					</bpel:literal>
				</bpel:from>
				<bpel:to>$appointment.RadiologyAppointmentRequest</bpel:to>
			</bpel:copy>
		</bpel:assign>	
		
		<!-- <bpel:assign validate="no" name="Assign-RadAppointment">
			<bpel:copy>
				<bpel:from>$radiologyOrderResponse.RadiologyOrderID</bpel:from>
				<bpel:to>$appointment.RadiologyAppointmentRequest/OrderID</bpel:to>
			</bpel:copy>
			<bpel:copy>
				<bpel:from><bpel:literal><rad:Appointment><Date>2014-04-24</Date></rad:Appointment></bpel:literal></bpel:from>
				<bpel:to>$appointment.RadiologyAppointmentRequest/Date</bpel:to>
			</bpel:copy>
		</bpel:assign> -->
		
		<!-- <bpel:invoke name="Invoke-RadService-RequestAppointment" partnerLink="radiologyDept"
			portType="rad:Radiology" operation="RequestAppointment" inputVariable="appointment"
			outputVariable="appointmentResponse"></bpel:invoke> -->
			
		<bpel:assign validate="no" name="Assign-Response">
			<bpel:copy>
				<bpel:from>$radiologyOrderResponse.RadiologyOrderID</bpel:from>
				<!-- <bpel:from>$appointment.RadiologyAppointmentRequest/OrderID</bpel:from>  -->
				<bpel:to>$response.TestResponse</bpel:to>
			</bpel:copy>
		</bpel:assign>
			
		<!-- <bpel:assign validate="no" name="Assign-Response">
			<bpel:copy>
				<bpel:from>$createPatientResponse.PatientID</bpel:from>
				<bpel:to>$response.AOResponse</bpel:to>
			</bpel:copy>
		</bpel:assign> -->
		
		<bpel:reply name="Reply-Response" partnerLink="ward"
			portType="tns:WardServicePT" operation="AdmissionOrder" variable="response"></bpel:reply>
		
	</bpel:sequence>    
</bpel:process>

